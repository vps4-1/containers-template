# Cloudflare Containers æ¶æ„æ–¹æ¡ˆè¯¦è§£

## ğŸ“‹ ç›®å½•

1. [æ•´ä½“æ¶æ„](#æ•´ä½“æ¶æ„)
2. [æ ¸å¿ƒæ¦‚å¿µ](#æ ¸å¿ƒæ¦‚å¿µ)
3. [æŠ€æœ¯æ ˆ](#æŠ€æœ¯æ ˆ)
4. [ç›®å½•ç»“æ„](#ç›®å½•ç»“æ„)
5. [æ•°æ®æµ](#æ•°æ®æµ)
6. [éƒ¨ç½²æµç¨‹](#éƒ¨ç½²æµç¨‹)
7. [ç›‘æ§ä¸è°ƒè¯•](#ç›‘æ§ä¸è°ƒè¯•)
8. [æœ€ä½³å®è·µ](#æœ€ä½³å®è·µ)

---

## ğŸ—ï¸ æ•´ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    äº’è”ç½‘ç”¨æˆ·è¯·æ±‚                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Cloudflare Edge Network                         â”‚
â”‚                  (å…¨çƒ CDN + è¾¹ç¼˜è®¡ç®—)                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               Cloudflare Worker (å‰ç«¯è·¯ç”±å±‚)                     â”‚
â”‚                                                                   â”‚
â”‚  ğŸ“¦ ç»„ä»¶: Hono Router (è½»é‡çº§æ¡†æ¶)                               â”‚
â”‚  ğŸ¯ èŒè´£:                                                        â”‚
â”‚    - å¥åº·æ£€æŸ¥ (GET /health)                                      â”‚
â”‚    - ç›‘æ§é¢æ¿ (GET /monitor)                                     â”‚
â”‚    - è¯·æ±‚è·¯ç”±åˆ° Container                                        â”‚
â”‚    - ç¯å¢ƒå˜é‡æ£€æŸ¥ (GET /api/env-check)                          â”‚
â”‚    - é™æ€èµ„æºæœåŠ¡                                                â”‚
â”‚                                                                   â”‚
â”‚  ğŸ“„ ä»£ç : src/index.ts (TypeScript)                              â”‚
â”‚  ğŸ“Š è¿è¡Œæ—¶: V8 Isolate (< 1ms å¯åŠ¨)                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â”‚ è·¯ç”±è§„åˆ™: /api/* â†’ Container
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          Cloudflare Container (åç«¯ä¸šåŠ¡é€»è¾‘å±‚)                   â”‚
â”‚                                                                   â”‚
â”‚  ğŸ“¦ è¿è¡Œç¯å¢ƒ: Docker Container (Node.js 18+)                     â”‚
â”‚  ğŸ¯ èŒè´£:                                                        â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚    â”‚  Express.js Web Server (container_src/server.js)      â”‚   â”‚
â”‚    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚    â”‚  æ ¸å¿ƒæœåŠ¡æ¨¡å— (container_src/services/)               â”‚   â”‚
â”‚    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚    â”‚  â”‚ 1. Firecrawl Service (firecrawl.js)             â”‚ â”‚   â”‚
â”‚    â”‚  â”‚    - ç½‘é¡µæŠ“å–                                    â”‚ â”‚   â”‚
â”‚    â”‚  â”‚    - æ™ºèƒ½è§£æ                                    â”‚ â”‚   â”‚
â”‚    â”‚  â”‚    - æ‰˜ç®¡ API è°ƒç”¨                               â”‚ â”‚   â”‚
â”‚    â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚   â”‚
â”‚    â”‚  â”‚ 2. RSS Service (rss.js)                         â”‚ â”‚   â”‚
â”‚    â”‚  â”‚    - RSS/Atom Feed è§£æ                         â”‚ â”‚   â”‚
â”‚    â”‚  â”‚    - XML å¤„ç†                                    â”‚ â”‚   â”‚
â”‚    â”‚  â”‚    - Feed éªŒè¯                                   â”‚ â”‚   â”‚
â”‚    â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚   â”‚
â”‚    â”‚  â”‚ 3. Hybrid Scraper (hybrid_scraper.js)           â”‚ â”‚   â”‚
â”‚    â”‚  â”‚    - L0: RSS-Bridge (ç¤¾äº¤åª’ä½“)                  â”‚ â”‚   â”‚
â”‚    â”‚  â”‚    - L1: è‡ªå»º Firecrawl (å¯é€‰)                  â”‚ â”‚   â”‚
â”‚    â”‚  â”‚    - L2: æ‰˜ç®¡ Firecrawl (é™çº§)                  â”‚ â”‚   â”‚
â”‚    â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚   â”‚
â”‚    â”‚  â”‚ 4. Deduplicator (deduplicator.js)               â”‚ â”‚   â”‚
â”‚    â”‚  â”‚    - å¿«é€Ÿå»é‡ (URL + æ ‡é¢˜)                      â”‚ â”‚   â”‚
â”‚    â”‚  â”‚    - è¯­ä¹‰å»é‡ (Workers AI åµŒå…¥)                 â”‚ â”‚   â”‚
â”‚    â”‚  â”‚    - ç›¸ä¼¼åº¦è®¡ç®—                                  â”‚ â”‚   â”‚
â”‚    â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚   â”‚
â”‚    â”‚  â”‚ 5. Editor Service (editor.js)                   â”‚ â”‚   â”‚
â”‚    â”‚  â”‚    - OpenRouter API è°ƒç”¨                        â”‚ â”‚   â”‚
â”‚    â”‚  â”‚    - æ‰¹é‡å†…å®¹ç¼–è¾‘                                â”‚ â”‚   â”‚
â”‚    â”‚  â”‚    - å¹¶è¡Œå¤„ç† (3 concurrent)                    â”‚ â”‚   â”‚
â”‚    â”‚  â”‚    - ä¸­è‹±æ–‡ç”Ÿæˆ                                  â”‚ â”‚   â”‚
â”‚    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                   â”‚
â”‚  ğŸ—‚ï¸ æ•°æ®é…ç½® (container_src/data/)                              â”‚
â”‚    - rss_feeds.json: 15 ä¸ª RSS æºé…ç½®                           â”‚
â”‚    - no_rss_sites.json: 16 ä¸ªç½‘é¡µæŠ“å–æº                         â”‚
â”‚    - sites.txt: Firecrawl åŸŸååˆ—è¡¨                              â”‚
â”‚                                                                   â”‚
â”‚  âš™ï¸ ç”Ÿå‘½å‘¨æœŸ:                                                    â”‚
â”‚    - å¯åŠ¨: Container é•œåƒ build & å¯åŠ¨ Express æœåŠ¡å™¨            â”‚
â”‚    - æ´»è·ƒ: å¤„ç†è¯·æ±‚ï¼Œæ‰§è¡Œä¸šåŠ¡é€»è¾‘                                â”‚
â”‚    - ä¼‘çœ : 10 åˆ†é’Ÿæ— è¯·æ±‚åè‡ªåŠ¨ä¼‘çœ  (sleepAfter = "10m")         â”‚
â”‚    - å”¤é†’: æ–°è¯·æ±‚è‡ªåŠ¨å”¤é†’ (å†·å¯åŠ¨ ~2-5s)                         â”‚
â”‚                                                                   â”‚
â”‚  ğŸ“Š èµ„æºé™åˆ¶:                                                    â”‚
â”‚    - æœ€å¤§å®ä¾‹æ•°: 10 (max_instances)                              â”‚
â”‚    - å†…å­˜: å®¹å™¨é™åˆ¶                                              â”‚
â”‚    - CPU: å…±äº« vCPU                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â”‚ å¤–éƒ¨ API è°ƒç”¨
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      å¤–éƒ¨æœåŠ¡é›†æˆ                                 â”‚
â”‚                                                                   â”‚
â”‚  ğŸŒ Firecrawl API (ç½‘é¡µæŠ“å–)                                     â”‚
â”‚     - URL: https://api.firecrawl.dev                            â”‚
â”‚     - é™é¢: æ ¹æ®è®¢é˜…è®¡åˆ’                                         â”‚
â”‚                                                                   â”‚
â”‚  ğŸ¤– OpenRouter API (AI ç¼–è¾‘)                                     â”‚
â”‚     - URL: https://openrouter.ai/api/v1                         â”‚
â”‚     - æ¨¡å‹: GPT-4, Claude, ç­‰                                    â”‚
â”‚                                                                   â”‚
â”‚  âš¡ Cloudflare Workers AI (åµŒå…¥/å»é‡)                            â”‚
â”‚     - æ¨¡å‹: @cf/baai/bge-base-en-v1.5                           â”‚
â”‚     - å‘é‡ç»´åº¦: 768                                              â”‚
â”‚                                                                   â”‚
â”‚  ğŸ“¡ RSS-Bridge (å¯é€‰ï¼Œç¤¾äº¤åª’ä½“è½¬ RSS)                            â”‚
â”‚     - è‡ªå»ºå®ä¾‹æˆ–å…¬å…±å®ä¾‹                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ æ ¸å¿ƒæ¦‚å¿µ

### 1. **Worker vs Container**

| ç‰¹æ€§ | Cloudflare Worker | Cloudflare Container |
|------|-------------------|---------------------|
| **è¿è¡Œç¯å¢ƒ** | V8 Isolate | Docker Container |
| **å¯åŠ¨æ—¶é—´** | < 1ms | 2-5s (å†·å¯åŠ¨) |
| **è¿è¡Œæ—¶** | JavaScript/TypeScript | ä»»æ„è¯­è¨€ (Node.js, Python, etc.) |
| **CPU æ—¶é—´** | 50ms (å…è´¹), 30s (ä»˜è´¹) | æ— ä¸¥æ ¼é™åˆ¶ |
| **å†…å­˜** | 128MB | æ›´å¤§ (å–å†³äºé…ç½®) |
| **é€‚ç”¨åœºæ™¯** | å¿«é€Ÿè·¯ç”±ã€è¾¹ç¼˜è®¡ç®— | å¤æ‚ä¸šåŠ¡é€»è¾‘ã€é•¿æ—¶é—´ä»»åŠ¡ |
| **æŒä¹…åŒ–** | Durable Objects | å®¹å™¨å†…æ–‡ä»¶ç³»ç»Ÿ |

### 2. **Durable Objects**

- Container åŸºäº **Durable Objects** å®ç°
- æ¯ä¸ª Container å®ä¾‹æœ‰å”¯ä¸€çš„ **Object ID**
- æä¾›æŒä¹…åŒ–å­˜å‚¨å’ŒçŠ¶æ€ç®¡ç†
- æ”¯æŒå•ä¾‹æ¨¡å¼ï¼ˆSingletonï¼‰å’Œå‘½åå®ä¾‹

### 3. **è·¯ç”±æœºåˆ¶**

```typescript
// Worker è·¯ç”±é€»è¾‘ (src/index.ts)
app.all("/api/*", async (c) => {
  // è·å– Container å®ä¾‹ï¼ˆå•ä¾‹æ¨¡å¼ï¼‰
  const container = getContainer(c.env.OPENCODE_AGENT);
  
  // è½¬å‘è¯·æ±‚åˆ° Container
  const response = await container.fetch(c.req.raw);
  
  return response;
});
```

### 4. **æ··åˆæŠ“å–æ¶æ„ (Hybrid Scraper)**

**ä¸‰çº§é™çº§ç­–ç•¥**:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ L0: RSS-Bridge (ä¼˜å…ˆçº§æœ€é«˜)                         â”‚
â”‚ - é€‚ç”¨åœºæ™¯: ç¤¾äº¤åª’ä½“ (çŸ¥ä¹ã€å¾®åšã€Twitter)          â”‚
â”‚ - ä¼˜ç‚¹: å¿«é€Ÿã€å…è´¹ã€æ— é…é¢é™åˆ¶                      â”‚
â”‚ - ç¼ºç‚¹: éœ€è¦è‡ªå»ºæˆ–ä½¿ç”¨å…¬å…±å®ä¾‹                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚ å¤±è´¥ â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ L1: è‡ªå»º Firecrawl (ä¸­ç­‰ä¼˜å…ˆçº§)                     â”‚
â”‚ - é€‚ç”¨åœºæ™¯: é«˜å¹¶å‘ã€æ•æ„Ÿæ•°æ®                        â”‚
â”‚ - ä¼˜ç‚¹: æ— é…é¢é™åˆ¶ã€å®Œå…¨æ§åˆ¶                        â”‚
â”‚ - ç¼ºç‚¹: éœ€è¦è‡ªå·±ç»´æŠ¤æœåŠ¡å™¨                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚ å¤±è´¥ â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ L2: æ‰˜ç®¡ Firecrawl (å…œåº•æ–¹æ¡ˆ)                       â”‚
â”‚ - é€‚ç”¨åœºæ™¯: é€šç”¨ç½‘é¡µæŠ“å–                            â”‚
â”‚ - ä¼˜ç‚¹: ç¨³å®šã€é«˜è´¨é‡                                â”‚
â”‚ - ç¼ºç‚¹: æœ‰é…é¢é™åˆ¶ã€æŒ‰è°ƒç”¨æ”¶è´¹                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ› ï¸ æŠ€æœ¯æ ˆ

### Worker å±‚ (å‰ç«¯)

- **æ¡†æ¶**: Hono (è½»é‡çº§ Web æ¡†æ¶)
- **è¯­è¨€**: TypeScript 5.9.3
- **è¿è¡Œæ—¶**: Cloudflare Workers (V8 Isolate)
- **éƒ¨ç½²å·¥å…·**: Wrangler 4.56.0

### Container å±‚ (åç«¯)

- **è¿è¡Œæ—¶**: Node.js 18+
- **æ¡†æ¶**: Express.js 4.18.2
- **å®¹å™¨**: Docker (åŸºäº Cloudflare Container é•œåƒ)
- **ä¾èµ–ç®¡ç†**: npm

### å¤–éƒ¨ä¾èµ–

- **@cloudflare/containers**: Container SDK
- **axios**: HTTP å®¢æˆ·ç«¯
- **xml2js**: XML è§£æ
- **@cloudflare/ai**: Workers AI SDK

---

## ğŸ“‚ ç›®å½•ç»“æ„

```
containers-template/
â”‚
â”œâ”€â”€ src/                          # Worker ä»£ç 
â”‚   â””â”€â”€ index.ts                  # Worker å…¥å£æ–‡ä»¶
â”‚       - OpenCodeAgentContainer ç±»å®šä¹‰
â”‚       - Hono è·¯ç”±é…ç½®
â”‚       - ç›‘æ§é¢æ¿ HTML
â”‚
â”œâ”€â”€ container_src/                # Container ä»£ç 
â”‚   â”œâ”€â”€ server.js                 # Express æœåŠ¡å™¨å…¥å£
â”‚   â”‚   - è·¯ç”±å®šä¹‰
â”‚   â”‚   - ä¸­é—´ä»¶é…ç½®
â”‚   â”‚   - é”™è¯¯å¤„ç†
â”‚   â”‚
â”‚   â”œâ”€â”€ services/                 # æ ¸å¿ƒæœåŠ¡æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ firecrawl.js         # Firecrawl æŠ“å–æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ rss.js               # RSS è§£ææœåŠ¡
â”‚   â”‚   â”œâ”€â”€ hybrid_scraper.js    # æ··åˆæŠ“å–æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ deduplicator.js      # å»é‡æœåŠ¡
â”‚   â”‚   â””â”€â”€ editor.js            # AI ç¼–è¾‘æœåŠ¡
â”‚   â”‚
â”‚   â”œâ”€â”€ data/                     # æ•°æ®é…ç½®
â”‚   â”‚   â”œâ”€â”€ rss_feeds.json       # RSS æºé…ç½® (15)
â”‚   â”‚   â”œâ”€â”€ no_rss_sites.json    # ç½‘é¡µæŠ“å–æº (16)
â”‚   â”‚   â””â”€â”€ sites.txt            # åŸŸååˆ—è¡¨
â”‚   â”‚
â”‚   â”œâ”€â”€ package.json             # Container ä¾èµ–
â”‚   â””â”€â”€ Dockerfile               # (å¯é€‰) è‡ªå®šä¹‰é•œåƒ
â”‚
â”œâ”€â”€ wrangler.jsonc               # Cloudflare é…ç½®
â”‚   - Worker é…ç½®
â”‚   - Container ç»‘å®š
â”‚   - Durable Objects é…ç½®
â”‚
â”œâ”€â”€ .dev.vars                    # æœ¬åœ°ç¯å¢ƒå˜é‡
â”œâ”€â”€ .env.example                 # ç¯å¢ƒå˜é‡æ¨¡æ¿
â”œâ”€â”€ package.json                 # Worker ä¾èµ–
â”œâ”€â”€ tsconfig.json                # TypeScript é…ç½®
â”œâ”€â”€ README.md                    # é¡¹ç›®è¯´æ˜
â”œâ”€â”€ DATA_SOURCES.md              # æ•°æ®æºæ–‡æ¡£
â””â”€â”€ check-status.sh              # çŠ¶æ€æ£€æŸ¥è„šæœ¬
```

---

## ğŸ”„ æ•°æ®æµ

### 1. **æ•°æ®æ”¶é›†æµç¨‹**

```
ç”¨æˆ·è¯·æ±‚
   â”‚
   â–¼
POST /api/collect
   â”‚
   â”œâ”€ Worker è·¯ç”±
   â”‚     â”‚
   â”‚     â–¼
   â”‚  Container.fetch()
   â”‚
   â–¼
Express /api/collect Handler
   â”‚
   â”œâ”€ è§£æ sources æ•°ç»„
   â”‚
   â”œâ”€ åˆ¤æ–­ type (auto/rss/firecrawl)
   â”‚
   â”œâ”€ For each source:
   â”‚   â”‚
   â”‚   â”œâ”€ RSS ç±»å‹ â†’ RSSService.fetchFeed()
   â”‚   â”‚                    â”‚
   â”‚   â”‚                    â”œâ”€ fetch RSS URL
   â”‚   â”‚                    â”œâ”€ è§£æ XML
   â”‚   â”‚                    â””â”€ æå–æ–‡ç« åˆ—è¡¨
   â”‚   â”‚
   â”‚   â””â”€ Firecrawl ç±»å‹ â†’ HybridScraper.smartScrape()
   â”‚                              â”‚
   â”‚                              â”œâ”€ L0: RSS-Bridge
   â”‚                              â”‚      â”‚
   â”‚                              â”‚      â””â”€ æˆåŠŸ â†’ è¿”å›
   â”‚                              â”‚      å¤±è´¥ â†“
   â”‚                              â”œâ”€ L1: è‡ªå»º Firecrawl
   â”‚                              â”‚      â”‚
   â”‚                              â”‚      â””â”€ æˆåŠŸ â†’ è¿”å›
   â”‚                              â”‚      å¤±è´¥ â†“
   â”‚                              â””â”€ L2: æ‰˜ç®¡ Firecrawl
   â”‚                                     â”‚
   â”‚                                     â””â”€ è¿”å›ç»“æœ
   â”‚
   â”œâ”€ æ±‡æ€»æ‰€æœ‰æ–‡ç« 
   â”‚
   â””â”€ è¿”å› JSON å“åº”
       {
         success: true,
         totalArticles: 150,
         sources: 10,
         articles: [...]
       }
```

### 2. **å®Œæ•´æµæ°´çº¿æµç¨‹**

```
POST /api/pipeline
   â”‚
   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ­¥éª¤ 1: æ•°æ®æ”¶é›†                   â”‚
â”‚ - éå†æ‰€æœ‰æ•°æ®æº                   â”‚
â”‚ - æ”¶é›†æ–‡ç« åˆ—è¡¨                     â”‚
â”‚ Result: åŸå§‹æ–‡ç« åˆ—è¡¨ (150+ ç¯‡)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ­¥éª¤ 2: å»é‡å¤„ç†                   â”‚
â”‚ - å¿«é€Ÿå»é‡: URL + æ ‡é¢˜ Hash       â”‚
â”‚ - è¯­ä¹‰å»é‡: Workers AI åµŒå…¥       â”‚
â”‚   â””â”€ è®¡ç®—æ–‡ç« å‘é‡                  â”‚
â”‚   â””â”€ ä½™å¼¦ç›¸ä¼¼åº¦æ¯”è¾ƒ                â”‚
â”‚   â””â”€ é˜ˆå€¼è¿‡æ»¤ (threshold: 0.9)    â”‚
â”‚ Result: å»é‡åæ–‡ç«  (80 ç¯‡)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ­¥éª¤ 3: æ‰¹é‡ç¼–è¾‘                   â”‚
â”‚ - åˆ†æ‰¹å¤„ç† (batchSize: 10)        â”‚
â”‚ - å¹¶è¡Œè°ƒç”¨ OpenRouter API (3)     â”‚
â”‚ - ç”Ÿæˆä¸­æ–‡æ‘˜è¦                     â”‚
â”‚ - ç”Ÿæˆè‹±æ–‡æ‘˜è¦ (å¯é€‰)              â”‚
â”‚ Result: ç¼–è¾‘åæ–‡ç«                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
        è¿”å›ç»“æœ
       {
         pipeline: {
           collected: 150,
           deduplicated: 80,
           edited: 80
         },
         results: [...]
       }
```

---

## ğŸš€ éƒ¨ç½²æµç¨‹

### 1. **æœ¬åœ°å¼€å‘éƒ¨ç½²**

```bash
# å®‰è£…ä¾èµ–
npm install

# é…ç½®ç¯å¢ƒå˜é‡
cp .env.example .dev.vars
# ç¼–è¾‘ .dev.vars å¡«å…¥ API Keys

# å¯åŠ¨æœ¬åœ°å¼€å‘æœåŠ¡å™¨
npm run dev

# è®¿é—®æœåŠ¡
# Worker: http://localhost:8787
# ç›‘æ§é¢æ¿: http://localhost:8787/monitor
# API: http://localhost:8787/api/health
```

### 2. **ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²**

```bash
# æ–¹å¼ä¸€: ä½¿ç”¨ wrangler CLI
wrangler deploy

# æ–¹å¼äºŒ: ä½¿ç”¨ npm script
npm run deploy

# æ–¹å¼ä¸‰: ä½¿ç”¨éƒ¨ç½²è„šæœ¬
bash deploy-now.sh
```

### 3. **éƒ¨ç½²é…ç½® (wrangler.jsonc)**

```jsonc
{
  "name": "opencode-agent",           // Worker åç§°
  "main": "src/index.ts",             // Worker å…¥å£
  "compatibility_date": "2025-01-01", // å…¼å®¹æ€§æ—¥æœŸ
  "compatibility_flags": ["nodejs_compat"],
  
  "containers": [                      // Container é…ç½®
    {
      "class_name": "OpenCodeAgentContainer",
      "image": "./Dockerfile",         // Dockerfile è·¯å¾„
      "max_instances": 10              // æœ€å¤§å®ä¾‹æ•°
    }
  ],
  
  "durable_objects": {                 // Durable Objects ç»‘å®š
    "bindings": [
      {
        "class_name": "OpenCodeAgentContainer",
        "name": "OPENCODE_AGENT"       // ç»‘å®šåç§°
      }
    ]
  }
}
```

### 4. **ç¯å¢ƒå˜é‡é…ç½®**

**æœ¬åœ°å¼€å‘ (.dev.vars)**:
```bash
FIRECRAWL_API_KEY=fc-xxx
OPENROUTER_API_KEY=sk-or-v1-xxx
CF_API_KEY=Fs0z_xxx
CF_ACCOUNT_ID=your_account_id
```

**ç”Ÿäº§ç¯å¢ƒ** (Cloudflare Dashboard):
1. ç™»å½• Cloudflare Dashboard
2. Workers & Pages â†’ é€‰æ‹©ä½ çš„ Worker
3. Settings â†’ Variables â†’ Edit variables
4. æ·»åŠ ç¯å¢ƒå˜é‡ï¼ˆåŒä¸Šï¼‰

---

## ğŸ“Š ç›‘æ§ä¸è°ƒè¯•

### 1. **ç›‘æ§é¢æ¿**

è®¿é—® `/monitor` ç«¯ç‚¹æŸ¥çœ‹ï¼š

- âœ… Worker å¥åº·çŠ¶æ€
- âœ… Container å¥åº·çŠ¶æ€
- âœ… ç¯å¢ƒå˜é‡æ£€æŸ¥
- âœ… API ç«¯ç‚¹æµ‹è¯•
- âœ… æ··åˆæŠ“å–æµ‹è¯•
- âœ… å®æ—¶æ—¥å¿—è¾“å‡º

### 2. **å¥åº·æ£€æŸ¥ç«¯ç‚¹**

```bash
# Worker å¥åº·æ£€æŸ¥
GET /health
Response: {
  status: "healthy",
  service: "opencode-agent-worker",
  container: true,
  timestamp: "2025-01-29T..."
}

# Container å¥åº·æ£€æŸ¥
GET /api/health
Response: {
  status: "healthy",
  service: "opencode-agent-container",
  instanceId: "instance-xxx",
  services: {
    firecrawl: true,
    telegram: false,
    cloudflare: true,
    openrouter: true
  }
}
```

### 3. **æ—¥å¿—æŸ¥çœ‹**

```bash
# å®æ—¶æ—¥å¿—
wrangler tail

# è¿‡æ»¤æ—¥å¿—
wrangler tail --format json | jq 'select(.outcome == "exception")'

# Cloudflare Dashboard
# Workers & Pages â†’ Your Worker â†’ Logs
```

### 4. **é”™è¯¯å¤„ç†**

æ‰€æœ‰ API ç«¯ç‚¹éƒ½æœ‰ç»Ÿä¸€çš„é”™è¯¯å“åº”æ ¼å¼ï¼š

```json
{
  "success": false,
  "error": "Error message",
  "timestamp": "2025-01-29T...",
  "hint": "è¯·æ£€æŸ¥ç¯å¢ƒå˜é‡é…ç½®"
}
```

---

## ğŸ’¡ æœ€ä½³å®è·µ

### 1. **æ€§èƒ½ä¼˜åŒ–**

- âœ… ä½¿ç”¨å¿«é€Ÿå»é‡ï¼ˆ`quick: true`ï¼‰å¤„ç†å¤§é‡æ•°æ®
- âœ… æ§åˆ¶æ‰¹å¤„ç†å¤§å°ï¼ˆ`batchSize: 10`ï¼‰
- âœ… é™åˆ¶å¹¶è¡Œåº¦ï¼ˆ`parallel: 3`ï¼‰
- âœ… è®¾ç½®åˆç†çš„ `sleepAfter` æ—¶é—´ï¼ˆé»˜è®¤ 10 åˆ†é’Ÿï¼‰

### 2. **æˆæœ¬æ§åˆ¶**

- âœ… ä¼˜å…ˆä½¿ç”¨ RSS æºï¼ˆå…è´¹ï¼‰
- âœ… ä½¿ç”¨æ··åˆæŠ“å–é™çº§ç­–ç•¥
- âœ… ç›‘æ§ API é…é¢ä½¿ç”¨æƒ…å†µ
- âœ… åˆ©ç”¨ Container è‡ªåŠ¨ä¼‘çœ æœºåˆ¶

### 3. **å¯é æ€§**

- âœ… å®ç°ä¸‰çº§é™çº§ç­–ç•¥
- âœ… æ·»åŠ é‡è¯•é€»è¾‘
- âœ… è®¾ç½®è¶…æ—¶æ—¶é—´
- âœ… è®°å½•è¯¦ç»†æ—¥å¿—

### 4. **å®‰å…¨æ€§**

- âœ… ä½¿ç”¨ç¯å¢ƒå˜é‡å­˜å‚¨ API Keys
- âœ… ä¸åœ¨ä»£ç ä¸­ç¡¬ç¼–ç æ•æ„Ÿä¿¡æ¯
- âœ… éªŒè¯è¾“å…¥å‚æ•°
- âœ… é™åˆ¶è¯·æ±‚é¢‘ç‡

### 5. **æ‰©å±•æ€§**

- âœ… JSON é…ç½®æ–‡ä»¶æ–¹ä¾¿æ·»åŠ æ•°æ®æº
- âœ… æ¨¡å—åŒ–æœåŠ¡è®¾è®¡
- âœ… æ”¯æŒå¤šå®ä¾‹éƒ¨ç½²ï¼ˆmax_instances: 10ï¼‰
- âœ… ä½¿ç”¨ Durable Objects å­˜å‚¨çŠ¶æ€

---

## ğŸ“ å…³é”®çŸ¥è¯†ç‚¹

### 1. **Container ç”Ÿå‘½å‘¨æœŸ**

```typescript
class OpenCodeAgentContainer extends Container<Env> {
  // å¯åŠ¨æ—¶æ‰§è¡Œ
  override onStart() {
    console.log("[Container] å¯åŠ¨æˆåŠŸ");
    // åˆå§‹åŒ–æ£€æŸ¥ã€æ•°æ®åŠ è½½ç­‰
  }

  // åœæ­¢æ—¶æ‰§è¡Œ
  override onStop() {
    console.log("[Container] åœæ­¢");
    // æ¸…ç†èµ„æºã€ä¿å­˜çŠ¶æ€ç­‰
  }

  // é”™è¯¯æ—¶æ‰§è¡Œ
  override onError(error: unknown) {
    console.error("[Container] é”™è¯¯:", error);
    // é”™è¯¯å¤„ç†ã€å‘Šè­¦ç­‰
  }
}
```

### 2. **Singleton æ¨¡å¼**

```typescript
// è·å–å•ä¾‹ Container å®ä¾‹
const container = getContainer(env.OPENCODE_AGENT);

// æ‰€æœ‰è¯·æ±‚å…±äº«åŒä¸€ä¸ªå®ä¾‹
// é€‚ç”¨äºæ— çŠ¶æ€æœåŠ¡æˆ–éœ€è¦å…¨å±€çŠ¶æ€çš„åœºæ™¯
```

### 3. **ç¯å¢ƒå˜é‡ä¼ é€’**

```typescript
// Worker â†’ Container
envVars = {
  NODE_ENV: "production",
  FIRECRAWL_API_KEY: process.env.FIRECRAWL_API_KEY || "",
  OPENROUTER_API_KEY: process.env.OPENROUTER_API_KEY || "",
  // ...
};

// Container å†…è®¿é—®
const apiKey = process.env.FIRECRAWL_API_KEY;
```

---

## ğŸ“š ç›¸å…³èµ„æº

- [Cloudflare Containers æ–‡æ¡£](https://developers.cloudflare.com/containers/)
- [Cloudflare Workers æ–‡æ¡£](https://developers.cloudflare.com/workers/)
- [Durable Objects æ–‡æ¡£](https://developers.cloudflare.com/durable-objects/)
- [Wrangler CLI æ–‡æ¡£](https://developers.cloudflare.com/workers/wrangler/)
- [é¡¹ç›® GitHub ä»“åº“](https://github.com/vps4-1/containers-template)

---

## ğŸ”‘ å¿«é€Ÿå‘½ä»¤å‚è€ƒ

```bash
# å¼€å‘
npm run dev                    # å¯åŠ¨æœ¬åœ°å¼€å‘æœåŠ¡å™¨
bash check-status.sh           # æ£€æŸ¥é¡¹ç›®çŠ¶æ€

# éƒ¨ç½²
npm run deploy                 # éƒ¨ç½²åˆ° Cloudflare
wrangler deploy               # ç›´æ¥ä½¿ç”¨ wrangler

# ç›‘æ§
wrangler tail                  # æŸ¥çœ‹å®æ—¶æ—¥å¿—
wrangler tail --format json    # JSON æ ¼å¼æ—¥å¿—

# ç®¡ç†
wrangler deployments list      # æŸ¥çœ‹éƒ¨ç½²å†å²
wrangler rollback             # å›æ»šåˆ°ä¸Šä¸€ç‰ˆæœ¬

# æµ‹è¯•
curl https://your-worker.workers.dev/health
curl https://your-worker.workers.dev/monitor
```

---

**æœ€åæ›´æ–°**: 2025-01-29
**ç‰ˆæœ¬**: v1.0.0
